<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Love & Support</title>
    <link rel="apple-touch-icon" href="https://example.com/your-app-icon.png"> <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="light-content">
    <meta name="apple-mobile-web-app-title" content="Daily Love">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Font and Basic Body Styles */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            overflow-x: hidden;
            /* Prevents scrollbar on small overflows */
            -webkit-overflow-scrolling: touch; /* Improves scrolling performance on iOS */
        }
        /* Hide scrollbar for webkit browsers (e.g., Safari) */
        ::-webkit-scrollbar {
            display: none;
        }
        /* For Firefox and IE */
        body {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- SVG Icons (same as before) ---
        const Heart = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
        );

        const Star = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="m12 2 3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2Z"/>
            </svg>
        );

        const Sparkles = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
                <path d="M5 3v4"/>
                <path d="M19 17v4"/>
                <path d="M3 5h4"/>
                <path d="M17 19h4"/>
            </svg>
        );

        const Gift = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M20 12v10H4V12"/>
                <path d="M2 7h20v5H2z"/>
                <path d="M12 22V7"/>
                <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/>
                <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
            </svg>
        );

        const Zap = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14H4Z"/>
            </svg>
        );

        const User = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const Settings = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
        );

        const Home = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9,22 9,12 15,12 15,22"/>
            </svg>
        );

        const Volume2 = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <path d="m15.54 8.46a5 5 0 0 1 0 7.07"/>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
            </svg>
        );

        const VolumeX = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                <line x1="22" x2="16" y1="9" y2="15"/>
                <line x1="16" x2="22" y1="9" y2="15"/>
            </svg>
        );

        const Award = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="8" r="6"/>
                <path d="m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-2.58-2.687a1 1 0 0 0-1.197-.093l-2.573 1.627a.5.5 0 0 1-.758-.51l1.483-8.326"/>
            </svg>
        );

        const BookHeart = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/>
                <path d="M16 8.2C16 7 15 6 13.8 6c-.8 0-1.4.3-1.8.9-.4-.6-1-.9-1.8-.9C9 6 8 7 8 8.2c0 .6.3 1.2.7 1.6L12 13l3.3-3.2c.4-.4.7-1 .7-1.6z"/>
            </svg>
        );

        const Smile = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <path d="m9 9 1.5 1.5L9 12"/>
                <path d="m15 9-1.5 1.5L15 12"/>
                <path d="M8 15s1.5 2 4 2 4-2 4-2"/>
            </svg>
        );

        const Meh = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <line x1="8" x2="16" y1="15" y2="15"/>
                <line x1="9" x2="9.01" y1="9" y2="9"/>
                <line x1="15" x2="15.01" y1="9" y2="9"/>
            </svg>
        );

        const Frown = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <path d="M16 16s-1.5-2-4-2-4 2-4 2"/>
                <line x1="9" x2="9.01" y1="9" y2="9"/>
                <line x1="15" x2="15.01" y1="9" y2="9"/>
            </svg>
        );

        const Moon = ({ className }) => (
            <svg className={className} fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
            </svg>
        );

        // --- Theme Definitions (same as before) ---
        const themes = {
          hellokitty: {
            name: "Hello Kitty",
            gradient: "from-pink-200 via-pink-100 to-white",
            accent: "text-pink-600",
            button: "bg-pink-400 hover:bg-pink-500 text-white",
            card: "bg-white/80 border-pink-200",
            icon: "üéÄ"
          },
          hearts: {
            name: "Hearts",
            gradient: "from-red-200 via-pink-200 to-red-100",
            accent: "text-red-600",
            button: "bg-red-400 hover:bg-red-500 text-white",
            card: "bg-white/80 border-red-200",
            icon: "üíï"
          },
          pastel: {
            name: "Soft Pastel",
            gradient: "from-purple-200 via-blue-200 to-pink-200",
            accent: "text-purple-600",
            button: "bg-purple-400 hover:bg-purple-500 text-white",
            card: "bg-white/80 border-purple-200",
            icon: "üå∏"
          },
          starry: {
            name: "Starry Night",
            gradient: "from-indigo-300 via-purple-300 to-blue-300",
            accent: "text-indigo-700",
            button: "bg-indigo-500 hover:bg-indigo-600 text-white",
            card: "bg-white/80 border-indigo-200",
            icon: "‚≠ê"
          },
          flowers: {
            name: "Garden",
            gradient: "from-green-200 via-yellow-200 to-green-200",
            accent: "text-green-700",
            button: "bg-green-400 hover:bg-green-500 text-white",
            card: "bg-white/80 border-green-200",
            icon: "üåª"
          },
          sunset: {
            name: "Sunset",
            gradient: "from-orange-200 via-yellow-200 to-pink-200",
            accent: "text-orange-600",
            button: "bg-orange-400 hover:bg-orange-500 text-white",
            card: "bg-white/80 border-orange-200",
            icon: "üåÖ"
          }
        };

        // --- Message Definitions (same as before) ---
        const messages = {
          motivational: [
            "You are stronger than you think and braver than you feel. Every small step forward is progress worth celebrating.",
            "Your dreams matter, and so do you. Take one tiny step today toward something that makes you smile.",
            "You've survived 100% of your worst days so far. That's an incredible track record of resilience.",
            "Progress isn't always perfect, and that's perfectly okay. You're doing amazing just by trying.",
            "Your future self is counting on you, and she believes in you completely.",
            "Every sunrise brings new possibilities, and today is full of potential just waiting for you.",
            "You don't have to be perfect to be worthy of love and happiness. You're enough, exactly as you are.",
            "Your story isn't over yet. The best chapters might still be waiting to be written.",
            "You have a unique light that the world needs. Don't let anyone dim your sparkle.",
            "Small steps in the right direction are still steps forward. Be proud of your progress."
          ],
          inspirational: [
            "You are a work of art in progress, and every day adds another beautiful brushstroke to your masterpiece.",
            "The world is a better place with you in it. Your presence makes a difference, even when you can't see it.",
            "You have overcome challenges before, and that same strength lives within you right now.",
            "Your kindness creates ripples of goodness that reach further than you'll ever know.",
            "You are writing your own story, and you get to decide what happens in the next chapter.",
            "There's something magical about your perspective that no one else can offer the world.",
            "You are not broken, you're breaking through. Sometimes we have to fall apart to fall back together stronger.",
            "Your sensitivity is a superpower - it allows you to feel deeply and love completely.",
            "You are exactly where you need to be right now, even if it doesn't feel like it.",
            "Every expert was once a beginner. Every journey starts with a single step. You're on your way."
          ],
          encouraging: [
            "You're doing better than you think you are. Give yourself credit for how far you've come.",
            "It's okay to rest. It's okay to take breaks. Self-care isn't selfish, it's necessary.",
            "You don't have to have it all figured out right now. Life is a journey, not a destination.",
            "Your feelings are valid, and it's okay to feel whatever you're feeling today.",
            "You are loved more than you know by people who see your worth even when you don't.",
            "Bad days don't last, but resilient people like you do. This too shall pass.",
            "You're allowed to be proud of yourself for the small things. They add up to big things.",
            "Your mental health matters. Taking care of yourself is a brave and important thing to do.",
            "You don't have to earn love - you are worthy of it simply because you exist.",
            "Every day you choose to keep going is an act of courage. You're braver than you know."
          ],
          compliments: [
            "Your smile has the power to brighten someone's entire day, even when you don't realize it.",
            "You have such a beautiful heart. The way you care about others is truly special.",
            "Your creativity and imagination make the world more colorful and interesting.",
            "You have an inner strength that shines through, even during difficult times.",
            "Your laugh is contagious in the best possible way. It brings joy to everyone around you.",
            "You have a unique way of seeing the world that adds beauty and meaning to everything you touch.",
            "Your empathy and compassion make you a rare and precious person.",
            "You are intelligent and capable of amazing things, even when you doubt yourself.",
            "Your presence brings comfort and warmth to the people who love you.",
            "You have survived every difficult day so far, which proves just how strong and incredible you are."
          ],
          affirmations: [
            "I am worthy of love and kindness, especially from myself.",
            "I am enough, just as I am, right here and right now.",
            "I choose to be patient and gentle with myself today.",
            "I am growing and learning every single day, even when I can't see it.",
            "I deserve happiness, peace, and all the good things life has to offer.",
            "I am strong enough to handle whatever comes my way.",
            "I choose to focus on progress, not perfection.",
            "I am surrounded by love, even when I feel alone.",
            "I trust that better days are coming, and I will be ready for them.",
            "I am brave, I am loved, and I am exactly where I need to be."
          ],
          parentMessages: [
            "Kiddo, I know today might be hard, but I want you to know that your old man believes in you more than anything.",
            "I'm not always great with words, but I need you to know - you are the best thing I've ever done in my life.",
            "I see you fighting battles that nobody else can see, and it makes me so proud of how strong you are.",
            "You don't have to be perfect for me to love you. I love you on your worst days just as much as your best ones.",
            "I remember teaching you to ride a bike and how you refused to give up. That same determination is still in you.",
            "Some days I wish I could fix everything for you like I did when you were small. But I believe you've got this.",
            "You have that incredible determination, and right now I'm grateful for that because it means you won't give up.",
            "I'm proud to be your dad. Even when you don't feel proud of yourself, I'm proud enough for both of us.",
            "When you smile, really smile, it reminds me why I work so hard to give you a good life.",
            "I know I don't say it enough, but you make me want to be a better man every single day.",
            "Your laugh is still my favorite sound in the world, even if I don't hear it as much lately.",
            "I love our random conversations about everything and nothing. You're smart in ways that amaze me.",
            "You've grown into having the best qualities, and somehow you made them even better. That's pretty incredible.",
            "I'm not going anywhere, kiddo. No matter how dark it gets, your dad will always be here.",
            "You became my little girl when you were just a little kid, and you'll always be my daughter, no matter how old you get.",
            "I love how you see the world differently than everyone else. Your perspective matters.",
            "From the day I became your dad, I promised to protect you from everything. I wish I could protect you from sadness too.",
            "You don't have to earn my love or approval. You've had both since the day you became my daughter.",
            "I'm learning alongside you that it's okay to have bad days. We'll figure this out together.",
            "You have such incredible strength, and your heart is even more amazing.",
            "I love watching you grow into your own person, even when it scares me how fast it's happening.",
            "You're not broken, sweetheart. You're human, and being human is hard sometimes.",
            "I wish I could take all your pain and carry it myself. Since I can't, I'll just walk beside you.",
            "Your worth isn't determined by how you feel about yourself. You're priceless to me, always.",
            "I love your messy hair in the morning and how you hog the TV remote. All of it.",
            "You challenge me to think differently about everything, and I'm grateful for that.",
            "I remember every proud moment since I became your dad - and I'm still collecting them.",
            "You make me laugh even when you're not trying to. You have a wonderful sense of humor.",
            "I love how you care so deeply about things. That big heart of yours is a gift.",
            "When you hurt, I hurt. When you heal, I heal. We're connected like that, you and me.",
            "You're allowed to rest. You're allowed to have bad days. You don't have to be strong all the time.",
            "I love our late-night talks when you can't sleep. Those moments mean everything to me.",
            "You're not a burden, you're not too much, and you're not too sensitive. You're exactly right.",
            "I see how hard you're trying, even when it doesn't feel like enough. It is enough.",
            "Your mental health matters to me. Your happiness matters to me. You matter to me.",
            "I love how you think about things deeply. You're thoughtful in ways that make me proud.",
            "I believe in your future, even when you can't see it clearly right now.",
            "You're my daughter, and that means you've got fight in you. I've seen it ever since you were little.",
            "I love our inside jokes and how we can make each other laugh at the randomest times.",
            "You don't have to have it all figured out. I'm still figuring things out too, and I'm way older.",
            "Your sensitivity isn't a weakness - it's one of your greatest strengths.",
            "I love how you remember little details about people. You have such a caring heart.",
            "Bad days don't last forever, but dads do. I'll be here through all of them.",
            "You're growing into an amazing woman, and I get a front-row seat to watch it happen.",
            "I love your independence, even when it means you don't need me as much as you used to.",
            "You make me proud in ways you don't even realize. Just being you is enough.",
            "You're my greatest achievement, my biggest source of pride, and my favorite person to spend time with."
          ]
        };

        const moodOptions = [
          { emoji: 'üòä', label: 'Happy', value: 'happy' },
          { emoji: 'üòê', label: 'Okay', value: 'okay' },
          { emoji: 'üò¢', label: 'Sad', value: 'sad' },
          { emoji: 'üò¥', label: 'Tired', value: 'tired' },
          { emoji: 'üò∞', label: 'Anxious', value: 'anxious' }
        ];

        const achievementList = [
          { key: 'firstDay', title: 'Welcome!', description: 'Started your journey', icon: 'üåü' },
          { key: 'weekStreak', title: 'Week Warrior', description: '7 days strong', icon: 'üî•' },
          { key: 'monthStreak', title: 'Monthly Master', description: '30 days of love', icon: 'üëë' },
          { key: 'moodTracker', title: 'Mood Mapper', description: 'Tracked your first mood', icon: 'üé≠' },
          { key: 'gratitudeWriter', title: 'Gratitude Guru', description: 'Wrote your first gratitude', icon: 'üìù' },
          { key: 'hugGiver', title: 'Hug Hero', description: 'Sent your first virtual hug', icon: 'ü§ó' }
        ];

        const DailyLoveApp = () => {
          // --- State Initialization with localStorage retrieval ---
          const [currentTheme, setCurrentTheme] = useState(() => localStorage.getItem('dailyLoveTheme') || 'hellokitty');
          const [currentMessage, setCurrentMessage] = useState('');
          const [messageCategory, setMessageCategory] = useState('');
          const [streak, setStreak] = useState(() => parseInt(localStorage.getItem('dailyLoveStreak')) || 1);
          const [currentView, setCurrentView] = useState('home');
          const [todaysDate, setTodaysDate] = useState('');
          const [showHug, setShowHug] = useState(false);
          const [soundEnabled, setSoundEnabled] = useState(() => localStorage.getItem('dailyLoveSound') === 'false' ? false : true); // 'true' is default
          const [todaysMood, setTodaysMood] = useState(() => localStorage.getItem('dailyLoveTodaysMood'));
          const [gratitudeEntry, setGratitudeEntry] = useState(''); 
          const [achievements, setAchievements] = useState(() => {
            try {
              const savedAchievements = JSON.parse(localStorage.getItem('dailyLoveAchievements'));
              // Ensure all achievement keys exist, even if new ones are added later
              return {
                firstDay: true, // This should always be true if the app is used once
                weekStreak: savedAchievements?.weekStreak || false,
                monthStreak: savedAchievements?.monthStreak || false,
                moodTracker: savedAchievements?.moodTracker || false,
                gratitudeWriter: savedAchievements?.gratitudeWriter || false,
                hugGiver: savedAchievements?.hugGiver || false
              };
            } catch (e) {
              console.error("Failed to parse achievements from localStorage", e);
              return {
                firstDay: true,
                weekStreak: false,
                monthStreak: false,
                moodTracker: false,
                gratitudeWriter: false,
                hugGiver: false
              };
            }
          });
          const [customMessages, setCustomMessages] = useState(() => {
            try {
              const savedCustomMessages = JSON.parse(localStorage.getItem('dailyLoveCustomMessages'));
              return savedCustomMessages || [];
            } catch (e) {
              console.error("Failed to parse custom messages from localStorage", e);
              return [];
            }
          });
          const [newCustomMessage, setNewCustomMessage] = useState('');
          const [savedGratitudeEntries, setSavedGratitudeEntries] = useState(() => {
            try {
              const savedEntries = JSON.parse(localStorage.getItem('dailyLoveGratitudeEntries'));
              return savedEntries || [];
            } catch (e) {
              console.error("Failed to parse gratitude entries from localStorage", e);
              return [];
            }
          });

          // --- Persistence Effects: Save state to localStorage whenever it changes ---
          useEffect(() => {
            localStorage.setItem('dailyLoveTheme', currentTheme);
          }, [currentTheme]);

          useEffect(() => {
            localStorage.setItem('dailyLoveSound', soundEnabled.toString()); // Store as string
          }, [soundEnabled]);

          useEffect(() => {
            localStorage.setItem('dailyLoveTodaysMood', todaysMood || ''); // Store null as empty string
          }, [todaysMood]);

          useEffect(() => {
            localStorage.setItem('dailyLoveStreak', streak.toString());
            // Award streak achievements
            if (streak >= 7 && !achievements.weekStreak) {
                setAchievements(prev => ({ ...prev, weekStreak: true }));
            }
            if (streak >= 30 && !achievements.monthStreak) {
                setAchievements(prev => ({ ...prev, monthStreak: true }));
            }
          }, [streak, achievements.weekStreak, achievements.monthStreak]); // Dependencies for streak and achievement checks

          useEffect(() => {
            localStorage.setItem('dailyLoveAchievements', JSON.stringify(achievements));
          }, [achievements]);

          useEffect(() => {
            localStorage.setItem('dailyLoveCustomMessages', JSON.stringify(customMessages));
          }, [customMessages]);

          useEffect(() => {
            localStorage.setItem('dailyLoveGratitudeEntries', JSON.stringify(savedGratitudeEntries));
          }, [savedGratitudeEntries]);

          // --- Daily Logic: Date, Message Rotation, Streak Update, Mood Reset ---
          useEffect(() => {
            const today = new Date();
            const dateString = today.toLocaleDateString('en-US', { 
              weekday: 'long', 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            });
            setTodaysDate(dateString);

            const todayISO = today.toISOString().split('T')[0]; // YYYY-MM-DD
            const lastVisitDate = localStorage.getItem('dailyLoveLastVisitDate');

            // Streak Logic
            if (lastVisitDate !== todayISO) {
                const lastVisit = lastVisitDate ? new Date(lastVisitDate) : null;
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);
                const yesterdayISO = yesterday.toISOString().split('T')[0];

                if (lastVisitDate === yesterdayISO) {
                    setStreak(prevStreak => (prevStreak || 0) + 1); // Increment streak
                } else {
                    setStreak(1); // Reset streak if not consecutive or first visit
                }
                localStorage.setItem('dailyLoveLastVisitDate', todayISO); // Update last visit date
            }
            
            // Mood Reset Logic for New Day
            const savedMoodDate = localStorage.getItem('dailyLoveTodaysMoodDate');
            if (savedMoodDate !== todayISO) {
                setTodaysMood(null); // Clear previous day's mood
                localStorage.removeItem('dailyLoveTodaysMood'); // Remove from storage just in case
                localStorage.setItem('dailyLoveTodaysMoodDate', todayISO); // Mark mood as reset for today
            }

            // Message Rotation Logic
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            
            // Combine default messages with custom messages
            let effectiveMessages = { ...messages }; // Start with a copy of default messages
            if (customMessages.length > 0) {
              // Ensure custom messages are treated as a distinct category for rotation
              effectiveMessages.custom = customMessages; 
            }

            const allEffectiveCategories = Object.keys(effectiveMessages).filter(category => 
                effectiveMessages[category] && effectiveMessages[category].length > 0
            );

            // Use the dayOfYear to cycle through categories and messages deterministically
            const categoryIndex = dayOfYear % allEffectiveCategories.length;
            const selectedCategoryKey = allEffectiveCategories[categoryIndex];
            const messageList = effectiveMessages[selectedCategoryKey];
            const messageIndex = Math.floor(dayOfYear / allEffectiveCategories.length) % messageList.length;
            
            setCurrentMessage(messageList[messageIndex]);
            setMessageCategory(selectedCategoryKey);

          }, [customMessages]); // Re-run effect if custom messages change (to update rotation pool)

          const currentThemeConfig = themes[currentTheme];

          const showVirtualHug = () => {
            setShowHug(true);
            
            if (soundEnabled) {
              // Assuming your sound file is directly in the root of your GitHub Pages repo
              // REPLACE 'YOUR_SOUND_FILE_NAME.mp3' with the actual name of your sound file
              const hugSound = new Audio('https://gelmage.github.io/hope-app/click.mp3'); 
              hugSound.play().catch(e => console.error("Sound playback failed:", e)); 
            }

            setTimeout(() => setShowHug(false), 3000); 
            if (!achievements.hugGiver) {
              setAchievements(prev => ({ ...prev, hugGiver: true }));
            }
          };
    
          const recordMood = (mood) => {
            setTodaysMood(mood);
            if (!achievements.moodTracker) {
              setAchievements(prev => ({ ...prev, moodTracker: true }));
            }
          };

          const saveGratitude = () => {
            if (gratitudeEntry.trim()) {
              // Save the entry
              setSavedGratitudeEntries(prev => [...prev, {
                text: gratitudeEntry.trim(),
                date: new Date().toLocaleDateString()
              }]);
              
              // Clear the text box
              setGratitudeEntry('');
              
              // Award achievement
              if (!achievements.gratitudeWriter) {
                setAchievements(prev => ({ ...prev, gratitudeWriter: true }));
              }
            }
          };

          const addCustomMessage = () => {
            if (newCustomMessage.trim()) {
              setCustomMessages(prev => [...prev, newCustomMessage.trim()]);
              setNewCustomMessage('');
            }
          };

          const navigationItems = [
            { key: 'home', icon: Home, label: 'Home' },
            { key: 'myspace', icon: User, label: 'My Space' },
            { key: 'themes', icon: Sparkles, label: 'Themes' },
            { key: 'vault', icon: Gift, label: 'Vault' },
            { key: 'settings', icon: Settings, label: 'Settings' }
          ];

          return (
            <div className={`min-h-screen bg-gradient-to-br ${currentThemeConfig.gradient} p-4 pb-20`}>
              <div className="max-w-md mx-auto">
                
                {/* HOME VIEW */}
                {currentView === 'home' && (
                  <div className="space-y-6">
                    <div className="text-center">
                      <h1 className={`text-3xl font-bold ${currentThemeConfig.accent} mb-2`}>
                        Good Morning, Beautiful! {currentThemeConfig.icon}
                      </h1>
                      <p className="text-gray-600">{todaysDate}</p>
                    </div>

                    <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4 text-center`}>
                      <div className="flex items-center justify-center gap-2 mb-2">
                        <Zap className={`w-6 h-6 ${currentThemeConfig.accent}`} />
                        <span className={`text-xl font-bold ${currentThemeConfig.accent}`}>Day {streak}</span>
                      </div>
                      <p className="text-sm text-gray-600">Your daily love streak!</p>
                    </div>

                    {!todaysMood && (
                      <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4`}>
                        <h3 className={`text-sm font-semibold ${currentThemeConfig.accent} mb-3`}>How are you feeling today?</h3>
                        <div className="flex gap-2 justify-center">
                          {moodOptions.map((mood) => (
                            <button
                              key={mood.value}
                              onClick={() => recordMood(mood.value)}
                              className="text-2xl hover:scale-110 transition-transform p-2"
                              title={mood.label}
                            >
                              {mood.emoji}
                            </button>
                          ))}
                        </div>
                      </div>
                    )}

                    <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-6`}>
                      <div className="flex items-center gap-2 mb-4">
                        <Heart className={`w-5 h-5 ${currentThemeConfig.accent}`} />
                        <span className={`text-sm font-semibold ${currentThemeConfig.accent} uppercase tracking-wide`}>
                          {messageCategory.replace(/([A-Z])/g, ' $1').toUpperCase()}
                        </span>
                      </div>
                      <p className="text-lg leading-relaxed text-gray-700 mb-4">
                        {currentMessage}
                      </p>
                      <div className="flex gap-3">
                        <button 
                          onClick={showVirtualHug}
                          className={`${currentThemeConfig.button} px-4 py-2 rounded-xl text-sm font-medium transition-all flex items-center gap-2`}
                        >
                          <Heart className="w-4 h-4" />
                          Send Hug Back
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* MY SPACE VIEW */}
                {currentView === 'myspace' && (
                  <div className="space-y-6">
                    <h2 className={`text-2xl font-bold ${currentThemeConfig.accent} text-center`}>My Space</h2>
                    
                    <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4`}>
                      <h3 className={`text-lg font-semibold ${currentThemeConfig.accent} mb-3 flex items-center gap-2`}>
                        <Award className="w-5 h-5" />
                        Achievements
                      </h3>
                      <div className="grid grid-cols-2 gap-2">
                        {achievementList.map((achievement) => (
                          <div
                            key={achievement.key}
                            className={`p-3 rounded-xl text-center ${
                              achievements[achievement.key] 
                                ? 'bg-yellow-100 border border-yellow-300' 
                                : 'bg-gray-100 border border-gray-200 opacity-50'
                            }`}
                          >
                            <div className="text-2xl mb-1">{achievement.icon}</div>
                            <div className="text-xs font-medium">{achievement.title}</div>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4`}>
                      <h3 className={`text-lg font-semibold ${currentThemeConfig.accent} mb-3`}>Today's Mood</h3>
                      {todaysMood ? (
                        <div className="text-center">
                          <div className="text-4xl mb-2">
                            {moodOptions.find(m => m.value === todaysMood)?.emoji}
                          </div>
                          <p className="text-gray-600 capitalize">{todaysMood}</p>
                        </div>
                      ) : (
                        <div className="flex gap-2 justify-center">
                          {moodOptions.map((mood) => (
                            <button
                              key={mood.value}
                              onClick={() => recordMood(mood.value)}
                              className="text-2xl hover:scale-110 transition-transform p-2"
                              title={mood.label}
                            >
                              {mood.emoji}
                            </button>
                          ))}
                        </div>
                      )}
                    </div>

                    <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4`}>
                      <h3 className={`text-lg font-semibold ${currentThemeConfig.accent} mb-3 flex items-center gap-2`}>
                        <BookHeart className="w-5 h-5" />
                        Gratitude Journal
                      </h3>
                      <textarea
                        value={gratitudeEntry}
                        onChange={(e) => setGratitudeEntry(e.target.value)}
                        onKeyDown={(e) => {
                          // Prevent Enter from triggering any form submission
                          if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                          }
                        }}
                        placeholder="What are you grateful for today?"
                        className="w-full p-3 border border-gray-300 rounded-xl resize-none text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"
                        rows="3"
                      />
                      <button 
                        onClick={saveGratitude}
                        className={`${currentThemeConfig.button} px-4 py-2 rounded-xl text-sm font-medium mt-3`}
                      >
                        Save Entry
                      </button>
                      
                      {/* Show saved entries if any */}
                      {savedGratitudeEntries.length > 0 && (
                        <div className="mt-4 pt-4 border-t border-gray-200">
                          <h4 className={`text-sm font-semibold ${currentThemeConfig.accent} mb-2`}>Recent Entries:</h4>
                          <div className="space-y-2 max-h-32 overflow-y-auto">
                            {savedGratitudeEntries.slice().reverse().map((entry, index) => ( // Show most recent first
                              <div key={index} className="text-xs bg-gray-50 p-2 rounded">
                                <div className="text-gray-600 mb-1">{entry.date}</div>
                                <div className="text-gray-800">{entry.text}</div>
                              </div>
                            ))}
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* THEMES VIEW */}
                {currentView === 'themes' && (
                  <div className="space-y-6">
                    <h2 className={`text-2xl font-bold ${currentThemeConfig.accent} text-center`}>Choose Your Vibe</h2>
                    
                    <div className="grid grid-cols-2 gap-4">
                      {Object.entries(themes).map(([key, theme]) => (
                        <button
                          key={key}
                          onClick={() => setCurrentTheme(key)}
                          className={`p-4 rounded-2xl border-2 transition-all ${
                            currentTheme === key 
                              ? `border-${currentThemeConfig.accent.split('-')[1]}-400 scale-105` // Use currentThemeConfig accent for border consistency
                              : 'border-gray-200 hover:scale-105'
                          }`}
                          style={{
                            background: `linear-gradient(135deg, ${theme.gradient.replace('from-', '').replace(' via-', ', ').replace(' to-', ', ')})`,
                          }}
                        >
                          <div className="text-3xl mb-2">{theme.icon}</div>
                          <div className={`text-sm font-medium ${theme.accent}`}>{theme.name}</div>
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                {/* VAULT VIEW */}
                {currentView === 'vault' && (
                  <div className="space-y-6">
                    <h2 className={`text-2xl font-bold ${currentThemeConfig.accent} text-center`}>Love Vault</h2>
                    
                    <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4`}>
                      <h3 className={`text-lg font-semibold ${currentThemeConfig.accent} mb-3`}>Add Personal Message</h3>
                      <textarea
                        value={newCustomMessage}
                        onChange={(e) => setNewCustomMessage(e.target.value)}
                        onKeyDown={(e) => {
                          // Prevent Enter from triggering any form submission
                          if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                          }
                        }}
                        placeholder="Write a personal message..."
                        className="w-full p-3 border border-gray-300 rounded-xl resize-none text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400 mb-3"
                        rows="3"
                      />
                      <button 
                        onClick={addCustomMessage}
                        className={`${currentThemeConfig.button} px-4 py-2 rounded-xl text-sm font-medium`}
                      >
                        Add Message
                      </button>
                    </div>

                    {/* Custom Messages Display */}
                    {customMessages.length > 0 ? (
                      <div className="space-y-3">
                        <h3 className={`text-lg font-semibold ${currentThemeConfig.accent}`}>Your Personal Messages</h3>
                        {customMessages.map((message, index) => (
                          <div key={index} className={`${currentThemeConfig.card} border-2 rounded-2xl p-4`}>
                            <div className="flex items-center gap-2 mb-2">
                              <Heart className={`w-4 h-4 ${currentThemeConfig.accent}`} />
                              <span className={`text-xs font-semibold ${currentThemeConfig.accent}`}>CUSTOM MESSAGE</span> {/* Changed from "FROM DAD/MOM" for general use */}
                            </div>
                            <p className="text-gray-700">{message}</p>
                          </div>
                        ))}
                      </div>
                    ) : (
                      <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4 text-center`}>
                        <Heart className={`w-8 h-8 ${currentThemeConfig.accent} mx-auto mb-3`} />
                        <h3 className={`text-lg font-semibold ${currentThemeConfig.accent} mb-2`}>Your Love Vault is Ready</h3>
                        <p className="text-gray-600 text-sm">Add personal messages above and they'll appear here for your daughter to see. These messages will be mixed into her daily rotation, making each day extra special.</p>
                      </div>
                    )}
                  </div>
                )}

                {/* SETTINGS VIEW */}
                {currentView === 'settings' && (
                  <div className="space-y-6">
                    <h2 className={`text-2xl font-bold ${currentThemeConfig.accent} text-center`}>Settings</h2>
                    
                    <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4`}>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          {soundEnabled ? <Volume2 className="w-5 h-5 text-gray-600" /> : <VolumeX className="w-5 h-5 text-gray-600" />}
                          <span className="font-medium">Sound Effects</span>
                        </div>
                        <button 
                          onClick={() => setSoundEnabled(!soundEnabled)}
                          className={`w-12 h-6 rounded-full transition-colors ${
                            soundEnabled ? 'bg-green-400' : 'bg-gray-300'
                          }`}
                        >
                          <div className={`w-5 h-5 bg-white rounded-full transition-transform ${
                            soundEnabled ? 'translate-x-6' : 'translate-x-1'
                          }`} />
                        </button>
                      </div>
                    </div>

                    <div className={`${currentThemeConfig.card} border-2 rounded-2xl p-4 text-center`}>
                      <h3 className={`text-lg font-semibold ${currentThemeConfig.accent} mb-2`}>App Info</h3>
                      <p className="text-sm text-gray-600 mb-2">Made with üíï by someone who loves you very much</p>
                      <p className="text-xs text-gray-500">Version 1.0 (with persistence!)</p>
                    </div>
                  </div>
                )}
              </div>

              {/* Bottom Navigation */}
              <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t border-gray-200 z-10"> {/* Added z-10 to ensure it's above other content */}
                <div className="max-w-md mx-auto flex justify-around py-2">
                  {navigationItems.map((item) => {
                    const IconComponent = item.icon;
                    return (
                      <button
                        key={item.key}
                        onClick={() => setCurrentView(item.key)}
                        className={`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-colors ${
                          currentView === item.key
                            ? `${currentThemeConfig.accent} bg-${currentThemeConfig.accent.split('-')[1]}-50`
                            : 'text-gray-500'
                        }`}
                      >
                        <IconComponent className="w-5 h-5" />
                        <span className="text-xs font-medium">{item.label}</span>
                      </button>
                    );
                  })}
                </div>
              </div>

              {/* Virtual Hug Animation */}
              {showHug && (
                <div className="fixed inset-0 bg-pink-200/50 flex items-center justify-center z-50">
                  <div className="bg-white rounded-3xl p-8 text-center animate-pulse">
                    <div className="text-6xl mb-4">ü§ó</div>
                    <div className="text-2xl font-bold text-pink-600 mb-2">Sending Virtual Hug!</div>
                    <div className="text-gray-600">You are so loved! üíï</div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // Render the main React component into the 'root' div
        ReactDOM.render(<DailyLoveApp />, document.getElementById('root'));
    </script>
</body>
</html>
